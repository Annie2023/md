## 二、基础知识

1、病毒的定义、分类、生命周期、特性；

​	定义：附着在其他程序上，自我繁殖的程序代码，复制后生成的新病毒同样具有感染其他程序的能力

分类

- 按操作系统   DOS病毒   Windows病毒    其他平台病毒
- 按照计算机病毒的破坏情况 良性 恶性
- 传播媒介  单机病毒：单机病毒（磁盘或光盘）    网络病毒（QQ、BBS、Email、FTP、Web）
- 按寄生方式和传染途径分类:
  引导型病毒
  文件型病毒
  引导型兼文件型病毒-混合型病毒

生命周期  (选择)

- 传染阶段：
  潜伏阶段：
  触发阶段：
  发作阶段

特性：

- **传染性**（最重要）
  隐蔽性
  潜伏性
  破坏性
  不可预见性

2、病毒对抗技术的方式以及各自的特点；  大概原理  molisi，cih，大麻引导性

破坏链路

 计算机病毒的三种机制  **传播**机制、**触发**机制和**破坏**机制

---

特征码扫描
	缺点：不能检测病毒变种或新型病毒；
		  特征库越来越大。

启发式扫描
	缺点：检测结果不准确
               无法准确辨认病毒的名称和类别

虚拟机技术 
     缺点：占用较多的系统资源，影响系统性能
                要很难准确辨认病毒类别
                开发投入较多

主动防御技术 
	实时监控程序系统调用来确定其行为

自免疫技术
   自校验和审计

## 三、PE病毒

1、PE病毒的定义，常见的PE文件类型；

2、PE文件的判别；

3、PE文件格式解析（标识的值及所在位置，***\*dos头\****、***\*dos hub(可插入程序)\****、PE文件头、PE可选头、节表、***\*数据目录\****等重要字段的值及其含义）；

4、导入（引入）表、导出（引出）表的定位以及解析；   int和IAT表描述  firstseek  originalfirstseek

### 5、RVA到FOA的转换过程；

遍历可执行文件的节表或段表，找到包含目标RVA所在的节或段的信息。
获取该节或段在文件中的起始偏移地址FOA1以及在内存中的起始地址VA1。
计算RVA与VA之间的偏移量:Offset = RVA - VA1。
计算FOA2 = FOA1 + Offset,得到目标RVA对应的FOA。
假设当前要转换的值为a，如果a是一个RVA，根据上述过程，需要先确定a所属的节或段，然后计算出a对应的FOA。如果a是一个FOA，可以通过相反的过程，即找到包含a所在的节或段，并计算出a对应的RVA。

**看实验看笔记！！！**

----

### PE文件中插入

6、往PE文件中插入病毒代码的3种主要方式(插入，新增，扩 展)，掌握每种方式的***\*操作步骤\****以及对***\*重要字段的修改\****；（了解流程）

![img](file:///D:/Program%20Files%20(x86)/Tencent/QQFile/3399085155/FileRecv/复习参考PPT/往年卷子/6.30日病毒原理/-1aa599d191ced21f.png)

![2256bb464b686564](D:\Program Files (x86)\Tencent\QQFile\3399085155\FileRecv\复习参考PPT\往年卷子\9.27日病毒原理\2256bb464b686564.jpg)

7、病毒代码运行过程中需要解决的问题（需要自身动态获取要加载的模块以及模块中函数的地址，问题转换为要去动态寻找loadlibrary函数所在模块的基址，掌握获取该基址的4种方式的原理）；

### 重定位

8、***\*重定位\****的原理以及代码实现；

病毒代码基地址= Delta的地址 - Delta的偏移量 

![image-20250101234313840](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250101234313840.png)

​          call delta
delta:   pop eax
​             sub eax,offset delta 

运行后，eax中存放的是病毒代码基地址
则
V2的地址 =  eax + offset v2

![image-20250101234953406](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250101234953406.png)

![3b3f519970a18e1e](D:\Program Files (x86)\Tencent\QQFile\3399085155\FileRecv\复习参考PPT\往年卷子\9.27日病毒原理\3b3f519970a18e1e.jpg)

### 动态获取API

9、动态***\*获取API函数地址\****的原理以及代码实现；文件解析xx***\*12-25/50页之后的\****

见apiasm.txt

LoadLibrary加载一个DLL，返回DLL地址
GetProcAddress通过DLL地址和API函数名获得API函数的地址

C语言实例：
DLL地址 = LoadLibrary(“DLL名”);
API函数地址 = GetProcAddress(DLL地址,“函数名”);

9、熟练掌握实验中（PPT中），GetProcAddress函数的汇编代码实现过程；

 

## 四、引导型病毒

1、引导型病毒的定义；

专门感染**磁盘引导扇区**和**硬盘主引导扇区**的计算机病毒程序

2、CHS方式访存的原理以及缺陷；

CHS(Cylinder/Head/Sector)参数 

**柱面数(Cylinders)** 表示硬盘每一面盘片上有几条磁道,最大为 1023(用 10 个二进制位存储);

**磁头数(Heads)**表示硬盘总共有几个磁头,也就是有几面盘片, 最大为 255 (用 8 个二进制位存储);
**扇区数(Sectors)** 表示每一条磁道上有几个扇区, 最大为 63(用 6个二进制位存储).每个扇区一般是 512个字节 
磁盘最大容量
255 * 1023 * 63 * 512 / 1048576 = 8024 MB ( 1M =1048576 Bytes )或
硬盘厂商常用的单位:255 * 1023 * 63 * 512 / 1000000 = 8414 MB ( 1M =1000000 Bytes )

3、莫里斯病毒、振荡波病毒、CIH病毒、大麻病毒的主要特点；

Morris病毒

- sendmail, finger 等服务的漏洞，消耗CPU资源，并导致拒绝服务

振荡波病毒

- **传播方式**：会在网络上自动搜索系统有漏洞的计算机，并直接引导这些计算机下载病毒文件并执行，因此整个传播和发作过程不需要人为干预。
- **攻击方式**：通过FTP的5554端口攻击计算机，使系统文件崩溃，造成计算机反复重启。
- **危害**：会使“安全认证子系统”进程LSASS.exe崩溃，出现系统反复重启的现象，并且使跟安全认证有关的程序出现严重运行错误。

CIH特点

- 网络（软件下载）传播
- 第一个能够破坏**计算机硬件**

- 巧妙的提升代码权限
- 文件型病毒

大麻病毒：石头病毒，专门感染软盘引导扇区和硬盘主引导扇区，破坏软盘

20世纪80年代，巴基斯坦的两个程序员为了防止盗版他们软件被盗版使用，设计了“智囊”病毒。这就是最早在世界上流行的第一个真正的病毒。
**莫里斯病毒，第一个网络病毒。**（蠕虫）
石头病毒，我国早期出现的病毒。

4、***\*主引导扇区的结构、MBR代码的主要功能\****；大致描述

主引导扇区由 主引导记录（MBR）、 硬盘主分区表（DPT） 和 引导扇区标记（Boot Record ID）    等三部分组成

![image-20250102001652513](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250102001652513.png)

![image-20250102001618108](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250102001618108.png)

![image-20250102002217869](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250102002217869.png)

5、***\*DPT表的数据解析\****（***\*每个分区表项16字节的含义\****）；会解析  倒着读

6、引导型病毒的工作环境、工作原理；

![img](file:///C:\Users\Annie\AppData\Local\Temp\ksohtml20596\wps1.jpg)

![img](file:///C:\Users\Annie\AppData\Local\Temp\ksohtml20596\wps2.jpg)![img](file:///C:\Users\Annie\AppData\Local\Temp\ksohtml20596\wps3.jpg)

7、系统的正常启动过程以及感染了引导型病毒之后的启动过程；

正常启动

（1）BIOS加电自检（POST），此时电源稳定后，CPU从内存地址__FFFF:0000____处开始执行。
（2）将硬盘第一个扇区读入内存地址0000：7C00处。
（3）检查0000：__7dfe__是否等于**0xaa55**,若不等于则转去尝试其他启动介质。
（4）跳转到0000:7C00处执行MBR中的程序。
（5）MBR首先将自身重定位到0000:0600处，然后继续执行。

MOV DI,0600
MOV CX,0100
REPNZ
MOVSW

（6）在主分区表中搜索标志为活动的分区。

（7）将活动分区的第一个扇区读入内存地址0000:7C00处。

MOV BX,7C00
MOV AX,0201
INT 13

（8）跳转到0000:7C00处继续执行特定的系统启动程序。

![image-20250101185847993](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250101185847993.png)

8、熟练掌握***\*int 13 中断\****的功能以及运用；读写硬盘相关参数（mov ax xxxxx） 7c00什么的

9、***\*实模式下1M内存的组成\**** ***\*三大部分：1.基本内存（640kb）0413 2.\****

- ![image-20250101185153850](C:\Users\Annie\AppData\Roaming\Typora\typora-user-images\image-20250101185153850.png)

### 常驻内存高端

10、***\*常驻内存高端的原理、hook int 13\**** ***\*向量表系统\*\*中断的原理\****

 病毒程序首先将自身复制到内存的高端，修改内存容量标志单元，在原有值的基础上减去病毒长度，使得病毒代码能够常驻内存；然后将原int 13h磁盘中断服务程序的中断向量保存，并修改此中断向量，将其指向病毒代码，病毒代码因此获得系统控制权，进而执行感染、破坏等工作。

## 五、蠕虫病毒

1、蠕虫病毒的概述，32位cdecl调用约定的特点，shellcode的定义以及特点；（传参方向，堆栈平衡）

可以从一台计算机移动到另一台计算机”和“可以自我复制”。

2、结合PPT上的“打开记事本”例子：熟练掌握缓冲区溢出的原理，会画函数栈帧的图   造成原因                  strcpy字符串拷贝，数据保护关闭dep

**由于程序缺少必要的边界检查，如果局部变量中有字符数组存在，只要赋予该数组的字符串足够长，就能将上面的返回地址覆盖掉。字符数组超出了开始为其分配的空间大小，缓冲区溢出就发生了。**

### Shellcode

3、payload（填充区域、覆盖返回地址、shellcode）的组成以及各部分主要关注的问题，PPT上加强shellcode通用性的代码原理；   填充区域长度关键，jmp esp指令的地址，shellcode

***\*Shellcode定义以及特点\****

 Shellcode是指能完成特殊任务的自包含的二进制代码，根据不同的任务可能是发出一条系统调用或建立一个高权限的Shell

Shellcode一般是作为数据形式发送给服务器，制造溢出得以执行代码并获取控制权的
（1）长度受限
（2）不能使用特殊字符，例如\x00、\xff等
（3）具有重定位能力
（4）一定的兼容性

## 六、木马

1、***\*文件型病毒与蠕虫病毒的区别；ppt第8页\****

2、***\*木马的组成三部分\****、***\*入侵过程\****、***\*自启动的方式\****、建立隐蔽通道的方式***\*，通信协议，常用技术，通信方式\****； 最重要特性隐蔽性

三部分 **木马配置程序，控制端程序（c），木马程序（s）**

木马入侵的基本过程是 <u>配置木马  、传播木马、运行木马、 建立连接 、信息反馈和 远程控制</u> 。

启动：**（选择）**       没有物理隐藏

- 捆绑应用程序,dll劫持     通信隐藏

  修改系统注册表的各种启动项（常用）  **进程隐藏**

  注册为一个系统服务   **服务隐藏**

  应用程序启动组

  修改文件关联

技术： DLL木马，Dll劫持，秘密信道技术

DLL木马最常用的是动态嵌入技术
运行时释放含有木马代码的DLL，并把这个DLL嵌入到系统进程或应用程序中，目前主要有两种动态嵌入DLL的方式窗口钩子、远程线程

---

利用TCP、UDP传输数据
利用WinSock与目标机的指定端口建立连接，使用send和recv等API进行数据的传递
这种方法的隐蔽性比较差，在命令行状态下使用**netstat**命令，就可以查看到当前的活动**TCP、UDP**连接

攻击者为了不让用户察觉其与木马程序之 间的通信，经常使用各种协议来建立控制服务端的秘密通信隧道
利用**ICMP**协议建立秘密通道
利用**HTTP**协议建立秘密通道

3、木马通常具备的功能，木马查找的主要工具；

 窃取信息、实施远程监控等。

***\*实验报告涉及代码补全的部分\****

***\*Lordpe解析节表  对应字段   节名字属性，两两一组（起始位置和长度）\****