# 代码审计简答题总结

## 常见代码审计四种思路

1. 根据敏感关键字或函数回溯参数传递过程
2. 查找可控变量，正向追踪变量传递过程。
3. 寻找敏感功能点，通读功能点代码。
4. 直接通读全文代码

### 敏感函数回溯参数过程

优点：只需搜索相应敏感关键字，即可以快速地**挖掘**想要的漏洞，具有可**定向挖掘和高效、高质量**的优点。

缺点：由于没有通读代码，对程序的整体框架了解不够深入，在挖掘漏洞时定位利用点会花费一点时间，另外对逻辑漏洞挖掘覆盖不到。

### 阅读全文的优点和缺点

优点:可以更好地了解程序的架构以及业务逻辑，能够挖掘到更多、更高质量的逻辑漏洞

缺点:花费的时间比较多，如果程序比较大，读起来也会比较累

## 文件管理的安全设计思路

防御：

禁止写入**脚本**可在服务端执行的文件

禁止上传**特殊字符文件名**的文件

限制文件管理功能**访问权限**

限制文件管理功能**操作的目录**

## 命令，代码执行

防御：

 严格控制该功能访问权限

设置命令白名单

设置独立密码

限制脚本可访问的路径

限制命令执行时的系统用户权限

## 验证码

防御：

设置错误次数

不将验证码放在HTML或cookie

验证码请求一次在后台强制刷新

动态生成

### API登录

防御：

用随机登录秘钥

禁止搜索引擎收录API接口

登录密钥绑定主机

### API（安全···）

防御：

访问权限控制，只有登录后/拥有密钥才能调用

防止敏感信息泄露

防止SQL注入等常规漏洞

### 注册

防御：

验证码

机器码拦截短时间多次注册

自学习识别垃圾账号

防止SQL与XSS

### 密码找回

防御：

接收验证码的手机与邮箱不由用户控制

验证码与用户名，邮箱绑定



加强验证码复杂度

限制验证码错误次数

设置验证码失效时间



不将验证码保存在页面

取验证码时防止短信轰炸



## 什么是sql注入漏洞，经常出现的地方

它允许攻击者通过构造恶意的SQL语句来操控数据库服务器，进而获取敏感数据、篡改数据、执行系统命令

SQL注入经常出现在

**登录页面**

**获取HTTP头(user-agent/client-ip等)**：client-ip和x-forward-for

**订单处理**：二次注入

表单，url，cookie，http头部，数据库查询语句拼接

## 宽字节注入

出现：在使用PHP连接MySQL的时候，当设置“set character_set _client=gbk”时会的导致一个编码转换的注入问题

产生原理：由于单引号被自动转义成\' ，前面的%df和转义字符\反斜杠(%5c)组合成了%df%5c，也就是“謰”字，这时候单引号依然还在，于是成功闭合了前面的单引号。

##### 关于宽字节注入漏洞几种推荐方法

1)在执行查询之前先执行SET NAMES‘gbk’，character-set-client=binary设置character-set -client为**binary**

2)使用mysql-set-charset(gbk)设置编码，然后使用mysqL realescape string()函数被参数过滤

3)**pdo方式**预编译